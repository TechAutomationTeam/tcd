machine:
  services:
    - docker
  environment:
    CGO_ENABLED: 0

dependencies:
  override:
    - go get -d
    - go build -o bin/tcd -installsuffix cgo
    - docker build -t kinvolk/tcd .

test:
  override:
    - echo "Tests disabled"

deployment:
  privatehub:
    branch: /.*master/
    commands:
      - >
        test "$DEPLOY_PRIVATE_HUB_BRANCH" == "" || test "$CIRCLE_BRANCH" != "$DEPLOY_PRIVATE_HUB_BRANCH" || (
          docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS &&
          docker tag kinvolk/tcd:latest $DOCKER_USER/tcd:latest &&
          docker push $DOCKER_USER/tcd
        )
